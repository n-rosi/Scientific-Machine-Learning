
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Exercise 14.X02 - Physics-Informed Neural Networks for inverse problems &#8212; sml report</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'Exercise 14.X02/Exercise_14.X02_';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="Exercise 14.X01" href="../Exercise%2014.X01/Exercise_14.X01_.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo.png" class="logo__image only-light" alt="sml report - Home"/>
    <script>document.write(`<img src="../_static/logo.png" class="logo__image only-dark" alt="sml report - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    Welcome to the Scientific Machine Learning Jupyter Book
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Exercises</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../Exercise%20X01.1/ExerciseX01.1_.html">Exercise X01.1 - Integration of Dynamical Systems</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Exercise%201.7/Exercise_1.7_.html">Exercise 1.7 - Singular Value Decomposition</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Exercise%202.3/Exercise_2.3_.html">Exercise 2.3 - Fast Fourier Transform (FFT) for Numerical Integration</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Exercise%206.1/6.1_toc.html">Exercise 6.1</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../Exercise%206.1/Exercise_6.1_KS_a_b.html">Neural Network for Numerical Integration on the Kuramoto–Sivashinsky (KS) PDE</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Exercise%206.1/Exercise_6.1_RD_a_b_c.html">Neural Network for Numerical Integration on the Reaction Diffusion System</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Exercise%206.1/Exercise6.1_L_d.html">Neural Network for Predicting the Lorenz System</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../Exercise%207.4/Exercise_7.4_.html">Exercise 7.4 - SINDy</a></li>


<li class="toctree-l1"><a class="reference internal" href="../Exercise%20X02.1/Exercise_X02_1.html">Exercise X02.1 - Fast Fourier Transform for Point-Wise Gradient Computations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Exercise%20X03.1/Exercise_X03.1_.html">Exercise X03.1 - Dynamic Mode Decomposition (DMD)</a></li>


<li class="toctree-l1"><a class="reference internal" href="../Exercise%2012.2/Exercise_12.2_.html">Exercise 12.2 - Galerkin method applied to the Kuramoto Sivashinsky dynamical system</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Exercise%2012.3/Exercise_12.3_.html">Exercise 12.3 - Autoencoders</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Exercise%2014.X01/Exercise_14.X01_.html">Exercise 14.X01</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Exercise 14.X02 - Physics-Informed Neural Networks for inverse problems</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book/issues/new?title=Issue%20on%20page%20%2FExercise 14.X02/Exercise_14.X02_.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/Exercise 14.X02/Exercise_14.X02_.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>

</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Exercise 14.X02 - Physics-Informed Neural Networks for inverse problems</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="exercise-14-x02-physics-informed-neural-networks-for-inverse-problems">
<h1>Exercise 14.X02 - Physics-Informed Neural Networks for inverse problems<a class="headerlink" href="#exercise-14-x02-physics-informed-neural-networks-for-inverse-problems" title="Link to this heading">#</a></h1>
<p>In exercise 14.X02 we re-implement the demo of the Inverse problem for the Lorenz system with exogenous input ( <a class="reference external" href="https://deepxde.readthedocs.io/en/latest/demos/pinn_inverse/lorenz.inverse.forced.html">DeepXDE documentation</a> ). This exercise was for us mainly an occasion to learn how to solve inverse problems with PINNs and familiarize with the library DeepXDE, for this reason, just some minor details such as the shape of the exogenous input are modified.</p>
<p>In this example, the Lorenz system subjected to an external force <span class="math notranslate nohighlight">\(f(t) = 10 \cdot sin(2\pi t) \cdot cos(2\pi t)\)</span>. The purpose of the exercise is to “discover” the Lorenz parameters <span class="math notranslate nohighlight">\(\sigma\)</span>, <span class="math notranslate nohighlight">\(\rho\)</span> and <span class="math notranslate nohighlight">\(\beta\)</span> from training data, thanks to the possibility of defining them as “trainable parameters” in the DeepXDE library.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">scipy</span> 
<span class="kn">from</span> <span class="nn">scipy.integrate</span> <span class="kn">import</span> <span class="n">odeint</span>
<span class="kn">import</span> <span class="nn">re</span>

<span class="c1"># Import deepxde and select desired backend.</span>
<span class="kn">import</span> <span class="nn">tensorflow.compat.v1</span> <span class="k">as</span> <span class="nn">tf</span>
<span class="n">tf</span><span class="o">.</span><span class="n">disable_eager_execution</span><span class="p">()</span>
<span class="kn">import</span> <span class="nn">deepxde</span> <span class="k">as</span> <span class="nn">dde</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Using backend: pytorch
Other supported backends: tensorflow.compat.v1, tensorflow, jax, paddle.
paddle supports more examples now and is recommended.
</pre></div>
</div>
</div>
</div>
<p>Generate the data to train the neural network.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># plot function</span>
<span class="k">def</span> <span class="nf">plot1</span><span class="p">(</span> <span class="n">lorenz</span> <span class="p">,</span> <span class="n">ex_input</span> <span class="p">):</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span> <span class="n">time</span> <span class="p">,</span> <span class="n">lorenz</span><span class="p">[</span> <span class="p">:</span> <span class="p">,</span> <span class="mi">0</span> <span class="p">]</span> <span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;x(t)&quot;</span> <span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span> <span class="n">time</span> <span class="p">,</span> <span class="n">lorenz</span><span class="p">[</span> <span class="p">:</span> <span class="p">,</span> <span class="mi">1</span> <span class="p">]</span> <span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;y(t)&quot;</span> <span class="p">)</span> 
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span> <span class="n">time</span> <span class="p">,</span> <span class="n">lorenz</span><span class="p">[</span> <span class="p">:</span> <span class="p">,</span> <span class="mi">2</span> <span class="p">]</span> <span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;z(t)&quot;</span> <span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span> <span class="n">time</span> <span class="p">,</span> <span class="n">ex_input</span> <span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;exogenous input&quot;</span> <span class="p">)</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;time&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;f(t)&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Lorenz system with exogenous input&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Define problem parameters.</span>
<span class="n">sigma_true</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">rho_true</span> <span class="o">=</span> <span class="mi">15</span>
<span class="n">beta_true</span> <span class="o">=</span> <span class="mi">8</span> <span class="o">/</span> <span class="mi">3</span>

<span class="c1"># Define time domain.</span>
<span class="n">T</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span> <span class="mi">0</span> <span class="p">,</span> <span class="n">T</span> <span class="p">,</span> <span class="mi">200</span> <span class="p">)</span>

<span class="c1"># Define exogenous input.</span>
<span class="n">ex_input</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">time</span> <span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">time</span> <span class="p">)</span> 

<span class="c1"># Define initial conditions.</span>
<span class="n">x0</span> <span class="o">=</span> <span class="p">[</span> <span class="o">-</span><span class="mi">8</span> <span class="p">,</span> <span class="mi">7</span> <span class="p">,</span> <span class="mi">27</span> <span class="p">]</span>

<span class="c1"># Define interpolating function for using exogenous variable without fixed time stamps.</span>
<span class="k">def</span> <span class="nf">int_func</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
    <span class="n">spline</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">interpolate</span><span class="o">.</span><span class="n">Rbf</span><span class="p">(</span> <span class="n">time</span> <span class="p">,</span> <span class="n">ex_input</span> <span class="p">,</span> <span class="n">function</span> <span class="o">=</span> <span class="s2">&quot;thin_plate&quot;</span> <span class="p">,</span> <span class="n">smooth</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">episilon</span> <span class="o">=</span> <span class="mi">0</span> <span class="p">)</span>
    <span class="k">return</span> <span class="n">spline</span><span class="p">(</span> <span class="n">t</span> <span class="p">)</span>

<span class="c1"># Modified Lorenz system (with exogenous input)</span>
<span class="k">def</span> <span class="nf">RHSLorez</span><span class="p">(</span> <span class="n">sys</span> <span class="p">,</span> <span class="n">t</span> <span class="p">):</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">sys</span>    
    <span class="n">dsysdt</span> <span class="o">=</span> <span class="p">[</span> <span class="n">sigma_true</span> <span class="o">*</span> <span class="p">(</span> <span class="n">y</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span> <span class="p">,</span> <span class="n">x</span> <span class="o">*</span> <span class="p">(</span> <span class="n">rho_true</span> <span class="o">-</span> <span class="n">z</span> <span class="p">)</span> <span class="o">-</span> <span class="n">y</span> <span class="p">,</span> <span class="n">x</span> <span class="o">*</span> <span class="n">y</span> <span class="o">-</span> <span class="n">beta_true</span> <span class="o">*</span> <span class="n">z</span> <span class="o">+</span> <span class="n">int_func</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="p">]</span>
    <span class="k">return</span> <span class="n">dsysdt</span>

<span class="c1"># solve ODE</span>
<span class="n">lorenz</span> <span class="o">=</span> <span class="n">odeint</span><span class="p">(</span> <span class="n">RHSLorez</span> <span class="p">,</span> <span class="n">x0</span> <span class="p">,</span> <span class="n">time</span> <span class="p">)</span>
<span class="n">plot1</span><span class="p">(</span> <span class="n">lorenz</span> <span class="p">,</span> <span class="n">ex_input</span> <span class="p">)</span>

<span class="n">time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/f97161ba6a9227f48e9e260a9d1e54a4831a8258fa4e9267a575913d76ad5f29.png" src="../_images/f97161ba6a9227f48e9e260a9d1e54a4831a8258fa4e9267a575913d76ad5f29.png" />
</div>
</div>
<p>Defie trainable variables <span class="math notranslate nohighlight">\(\sigma\)</span> , <span class="math notranslate nohighlight">\(\rho\)</span> and <span class="math notranslate nohighlight">\(\beta\)</span>, which are now initialized to <span class="math notranslate nohighlight">\(1.0\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sigma</span> <span class="o">=</span> <span class="n">dde</span><span class="o">.</span><span class="n">Variable</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>
<span class="n">rho</span> <span class="o">=</span> <span class="n">dde</span><span class="o">.</span><span class="n">Variable</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>
<span class="n">beta</span> <span class="o">=</span> <span class="n">dde</span><span class="o">.</span><span class="n">Variable</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Create the Lorenz system.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">Lorenz_system</span><span class="p">(</span> <span class="n">t</span> <span class="p">,</span> <span class="n">sys</span> <span class="p">,</span> <span class="n">f</span> <span class="p">):</span>
<span class="w">    </span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    INPUT:</span>
<span class="sd">    t ( vec ): time coordinat</span>
<span class="sd">    sys ( array ): output of the network.</span>
<span class="sd">    f ( func ): exogenous function.</span>
<span class="sd">    </span>
<span class="sd">    OUTPU:</span>
<span class="sd">    lorenz system.</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">x</span> <span class="p">,</span> <span class="n">y</span> <span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">sys</span><span class="p">[</span> <span class="p">:</span> <span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">1</span> <span class="p">],</span> <span class="n">sys</span><span class="p">[</span> <span class="p">:</span> <span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">2</span> <span class="p">],</span> <span class="n">sys</span><span class="p">[</span> <span class="p">:</span> <span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="p">]</span>
    <span class="n">dx_t</span> <span class="o">=</span> <span class="n">dde</span><span class="o">.</span><span class="n">grad</span><span class="o">.</span><span class="n">jacobian</span><span class="p">(</span> <span class="n">sys</span> <span class="p">,</span> <span class="n">t</span> <span class="p">,</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span> <span class="p">)</span>
    <span class="n">dy_t</span> <span class="o">=</span> <span class="n">dde</span><span class="o">.</span><span class="n">grad</span><span class="o">.</span><span class="n">jacobian</span><span class="p">(</span> <span class="n">sys</span> <span class="p">,</span> <span class="n">t</span> <span class="p">,</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">)</span>
    <span class="n">dz_t</span> <span class="o">=</span> <span class="n">dde</span><span class="o">.</span><span class="n">grad</span><span class="o">.</span><span class="n">jacobian</span><span class="p">(</span> <span class="n">sys</span> <span class="p">,</span> <span class="n">t</span> <span class="p">,</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">2</span> <span class="p">)</span>
    
    <span class="k">return</span> <span class="p">[</span> <span class="n">dx_t</span> <span class="o">-</span> <span class="n">sigma</span> <span class="o">*</span> <span class="p">(</span> <span class="n">y</span> <span class="o">-</span> <span class="n">x</span> <span class="p">)</span> <span class="p">,</span> <span class="n">dy_t</span> <span class="o">-</span> <span class="n">x</span> <span class="o">*</span> <span class="p">(</span> <span class="n">rho</span> <span class="o">-</span> <span class="n">z</span> <span class="p">)</span> <span class="o">+</span> <span class="n">y</span> <span class="p">,</span> <span class="n">dz_t</span> <span class="o">-</span> <span class="n">x</span> <span class="o">*</span> <span class="n">y</span> <span class="o">+</span> <span class="n">beta</span> <span class="o">*</span> <span class="n">z</span> <span class="o">-</span> <span class="n">f</span> <span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">TimeDomain</span></code> is used to initialize a <code class="docutils literal notranslate"><span class="pre">geom</span></code> object, needed to define uinitial conditions with <code class="docutils literal notranslate"><span class="pre">dde</span></code>. Similarly, the <code class="docutils literal notranslate"><span class="pre">boundary</span></code> function should return <code class="docutils literal notranslate"><span class="pre">True</span></code> for points inside the subdomain and <code class="docutils literal notranslate"><span class="pre">False</span></code> for the points outside and it is also used to specify the initial conditions icx , icy and icz.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Initialize the TimeDomain object.</span>
<span class="n">geom</span> <span class="o">=</span> <span class="n">dde</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">TimeDomain</span><span class="p">(</span> <span class="mi">0</span> <span class="p">,</span> <span class="n">T</span> <span class="p">)</span>

<span class="c1"># Define initial conditions.</span>
<span class="k">def</span> <span class="nf">boundary</span><span class="p">(</span> <span class="n">_</span> <span class="p">,</span> <span class="n">on_initial</span> <span class="p">):</span>
    <span class="k">return</span> <span class="n">on_initial</span>
<span class="n">icx</span> <span class="o">=</span> <span class="n">dde</span><span class="o">.</span><span class="n">icbc</span><span class="o">.</span><span class="n">IC</span><span class="p">(</span> <span class="n">geom</span> <span class="p">,</span> <span class="k">lambda</span> <span class="n">X</span><span class="p">:</span> <span class="n">x0</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">,</span> <span class="n">boundary</span><span class="p">,</span> <span class="n">component</span> <span class="o">=</span> <span class="mi">0</span> <span class="p">)</span>
<span class="n">icy</span> <span class="o">=</span> <span class="n">dde</span><span class="o">.</span><span class="n">icbc</span><span class="o">.</span><span class="n">IC</span><span class="p">(</span> <span class="n">geom</span> <span class="p">,</span> <span class="k">lambda</span> <span class="n">X</span><span class="p">:</span> <span class="n">x0</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">,</span> <span class="n">boundary</span><span class="p">,</span> <span class="n">component</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">)</span>
<span class="n">icz</span> <span class="o">=</span> <span class="n">dde</span><span class="o">.</span><span class="n">icbc</span><span class="o">.</span><span class="n">IC</span><span class="p">(</span> <span class="n">geom</span> <span class="p">,</span> <span class="k">lambda</span> <span class="n">X</span><span class="p">:</span> <span class="n">x0</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="p">,</span> <span class="n">boundary</span><span class="p">,</span> <span class="n">component</span> <span class="o">=</span> <span class="mi">2</span> <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Training data are organized thanks to the numerical integration performed above.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Assign training data.</span>
<span class="n">observe_x</span> <span class="o">=</span> <span class="n">dde</span><span class="o">.</span><span class="n">icbc</span><span class="o">.</span><span class="n">PointSetBC</span><span class="p">(</span> <span class="n">time</span> <span class="p">,</span> <span class="n">lorenz</span><span class="p">[</span> <span class="p">:</span> <span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">1</span> <span class="p">]</span> <span class="p">,</span> <span class="n">component</span> <span class="o">=</span> <span class="mi">0</span> <span class="p">)</span>
<span class="n">observe_y</span> <span class="o">=</span> <span class="n">dde</span><span class="o">.</span><span class="n">icbc</span><span class="o">.</span><span class="n">PointSetBC</span><span class="p">(</span> <span class="n">time</span> <span class="p">,</span> <span class="n">lorenz</span><span class="p">[</span> <span class="p">:</span> <span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">2</span> <span class="p">]</span> <span class="p">,</span> <span class="n">component</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">)</span>
<span class="n">observe_z</span> <span class="o">=</span> <span class="n">dde</span><span class="o">.</span><span class="n">icbc</span><span class="o">.</span><span class="n">PointSetBC</span><span class="p">(</span> <span class="n">time</span> <span class="p">,</span> <span class="n">lorenz</span><span class="p">[</span> <span class="p">:</span> <span class="p">,</span> <span class="mi">2</span><span class="p">:</span><span class="mi">3</span> <span class="p">]</span> <span class="p">,</span> <span class="n">component</span> <span class="o">=</span> <span class="mi">2</span> <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The data object defined below contains all the information about the Lorenz system and the customed domain we used in the exercise:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># define data object</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">dde</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">PDE</span><span class="p">(</span>
    <span class="n">geom</span> <span class="p">,</span>
    <span class="n">Lorenz_system</span> <span class="p">,</span> <span class="c1"># analytical description of Lorenz system.</span>
    <span class="p">[</span> <span class="n">icx</span> <span class="p">,</span> <span class="n">icy</span> <span class="p">,</span> <span class="n">icz</span> <span class="p">,</span> <span class="n">observe_x</span> <span class="p">,</span> <span class="n">observe_y</span> <span class="p">,</span> <span class="n">observe_z</span> <span class="p">],</span> <span class="c1"># initial conditions + dataset.</span>
    <span class="n">num_domain</span> <span class="o">=</span> <span class="mi">400</span> <span class="p">,</span> <span class="c1"># number of points in the time domain.</span>
    <span class="n">num_boundary</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="c1"># number of points on the boundary.</span>
    <span class="n">anchors</span> <span class="o">=</span> <span class="n">time</span> <span class="p">,</span> <span class="c1"># additional points (beyond num_domain and num_boundary) used for training.</span>
    <span class="n">auxiliary_var_function</span> <span class="o">=</span> <span class="n">int_func</span> <span class="p">,</span> <span class="c1"># interpolation function.</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The neural network is defined as follow:</p>
<ul class="simple">
<li><p>input has dimension 1.</p></li>
<li><p>there are 3 hidden layers with 40 units weach and tanh as activation function (other deeper configuration with less units per layer were tried, however with poorer results).</p></li>
<li><p>output has dimension 3 and a linear activation function.</p></li>
</ul>
<p>Additionally, callbacks are define to store results and the model is trained for 10000 epochs.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fnamevar</span> <span class="o">=</span> <span class="s2">&quot;variables.dat&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">net</span> <span class="o">=</span> <span class="n">dde</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">FNN</span><span class="p">(</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="mi">40</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">+</span> <span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="s2">&quot;tanh&quot;</span><span class="p">,</span> <span class="s2">&quot;Glorot uniform&quot;</span> <span class="p">)</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">dde</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span> <span class="n">data</span> <span class="p">,</span> <span class="n">net</span> <span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span> <span class="s2">&quot;adam&quot;</span> <span class="p">,</span> <span class="n">lr</span> <span class="o">=</span> <span class="mf">0.001</span> <span class="p">,</span> <span class="n">external_trainable_variables</span> <span class="o">=</span> <span class="p">[</span> <span class="n">sigma</span> <span class="p">,</span> <span class="n">rho</span> <span class="p">,</span> <span class="n">beta</span> <span class="p">])</span>

<span class="n">variable</span> <span class="o">=</span> <span class="n">dde</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">VariableValue</span><span class="p">(</span> <span class="p">[</span> <span class="n">sigma</span> <span class="p">,</span> <span class="n">rho</span> <span class="p">,</span> <span class="n">beta</span> <span class="p">],</span> <span class="n">period</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span> <span class="n">filename</span> <span class="o">=</span> <span class="n">fnamevar</span> <span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">train</span><span class="p">(</span> <span class="n">iterations</span> <span class="o">=</span> <span class="mi">90000</span><span class="p">,</span> <span class="n">callbacks</span> <span class="o">=</span> <span class="p">[</span> <span class="n">variable</span> <span class="p">]</span> <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Compiling model...
&#39;compile&#39; took 0.000218 s
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Training model...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Step      Train loss                                                                                    Test loss                                                                                     Test metric
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0         [1.10e-01, 4.89e-02, 1.26e+01, 6.40e+01, 4.90e+01, 7.29e+02, 3.64e+01, 3.71e+01, 2.10e+02]    [1.10e-01, 4.89e-02, 1.26e+01, 6.40e+01, 4.90e+01, 7.29e+02, 3.64e+01, 3.71e+01, 2.10e+02]    []  
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1000      [5.18e+00, 3.11e+00, 1.29e+01, 3.37e+01, 1.04e-06, 1.20e+00, 3.52e+01, 6.65e+00, 1.26e+01]    [5.18e+00, 3.11e+00, 1.29e+01, 3.37e+01, 1.04e-06, 1.20e+00, 3.52e+01, 6.65e+00, 1.26e+01]    []  
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2000      [9.25e+00, 2.32e+00, 9.59e+00, 1.82e+01, 2.37e-01, 1.25e+00, 3.55e+01, 1.25e+01, 6.49e+00]    [9.25e+00, 2.32e+00, 9.59e+00, 1.82e+01, 2.37e-01, 1.25e+00, 3.55e+01, 1.25e+01, 6.49e+00]    []  
</pre></div>
</div>
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">KeyboardInterrupt</span><span class="g g-Whitespace">                         </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">9</span><span class="p">],</span> <span class="n">line</span> <span class="mi">6</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span> <span class="s2">&quot;adam&quot;</span> <span class="p">,</span> <span class="n">lr</span> <span class="o">=</span> <span class="mf">0.001</span> <span class="p">,</span> <span class="n">external_trainable_variables</span> <span class="o">=</span> <span class="p">[</span> <span class="n">sigma</span> <span class="p">,</span> <span class="n">rho</span> <span class="p">,</span> <span class="n">beta</span> <span class="p">])</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span> <span class="n">variable</span> <span class="o">=</span> <span class="n">dde</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">VariableValue</span><span class="p">(</span> <span class="p">[</span> <span class="n">sigma</span> <span class="p">,</span> <span class="n">rho</span> <span class="p">,</span> <span class="n">beta</span> <span class="p">],</span> <span class="n">period</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span> <span class="n">filename</span> <span class="o">=</span> <span class="n">fnamevar</span> <span class="p">)</span>
<span class="ne">----&gt; </span><span class="mi">6</span> <span class="n">model</span><span class="o">.</span><span class="n">train</span><span class="p">(</span> <span class="n">iterations</span> <span class="o">=</span> <span class="mi">90000</span><span class="p">,</span> <span class="n">callbacks</span> <span class="o">=</span> <span class="p">[</span> <span class="n">variable</span> <span class="p">]</span> <span class="p">)</span>

<span class="nn">File ~/conda/envs/jupybook/lib/python3.10/site-packages/deepxde/utils/internal.py:22,</span> in <span class="ni">timing.&lt;locals&gt;.wrapper</span><span class="nt">(*args, **kwargs)</span>
<span class="g g-Whitespace">     </span><span class="mi">19</span> <span class="nd">@wraps</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">20</span> <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="g g-Whitespace">     </span><span class="mi">21</span>     <span class="n">ts</span> <span class="o">=</span> <span class="n">timeit</span><span class="o">.</span><span class="n">default_timer</span><span class="p">()</span>
<span class="ne">---&gt; </span><span class="mi">22</span>     <span class="n">result</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">23</span>     <span class="n">te</span> <span class="o">=</span> <span class="n">timeit</span><span class="o">.</span><span class="n">default_timer</span><span class="p">()</span>
<span class="g g-Whitespace">     </span><span class="mi">24</span>     <span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">rank</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>

<span class="nn">File ~/conda/envs/jupybook/lib/python3.10/site-packages/deepxde/model.py:657,</span> in <span class="ni">Model.train</span><span class="nt">(self, iterations, batch_size, display_every, disregard_previous_best, callbacks, model_restore_path, model_save_path, epochs)</span>
<span class="g g-Whitespace">    </span><span class="mi">655</span>     <span class="k">if</span> <span class="n">iterations</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">656</span>         <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No iterations for </span><span class="si">{}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">opt_name</span><span class="p">))</span>
<span class="ne">--&gt; </span><span class="mi">657</span>     <span class="bp">self</span><span class="o">.</span><span class="n">_train_sgd</span><span class="p">(</span><span class="n">iterations</span><span class="p">,</span> <span class="n">display_every</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">658</span> <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">on_train_end</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">660</span> <span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">rank</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>

<span class="nn">File ~/conda/envs/jupybook/lib/python3.10/site-packages/deepxde/model.py:675,</span> in <span class="ni">Model._train_sgd</span><span class="nt">(self, iterations, display_every)</span>
<span class="g g-Whitespace">    </span><span class="mi">670</span> <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">on_batch_begin</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">672</span> <span class="bp">self</span><span class="o">.</span><span class="n">train_state</span><span class="o">.</span><span class="n">set_data_train</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">673</span>     <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">train_next_batch</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">674</span> <span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">675</span> <span class="bp">self</span><span class="o">.</span><span class="n">_train_step</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">676</span>     <span class="bp">self</span><span class="o">.</span><span class="n">train_state</span><span class="o">.</span><span class="n">X_train</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">677</span>     <span class="bp">self</span><span class="o">.</span><span class="n">train_state</span><span class="o">.</span><span class="n">y_train</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">678</span>     <span class="bp">self</span><span class="o">.</span><span class="n">train_state</span><span class="o">.</span><span class="n">train_aux_vars</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">679</span> <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">681</span> <span class="bp">self</span><span class="o">.</span><span class="n">train_state</span><span class="o">.</span><span class="n">epoch</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="g g-Whitespace">    </span><span class="mi">682</span> <span class="bp">self</span><span class="o">.</span><span class="n">train_state</span><span class="o">.</span><span class="n">step</span> <span class="o">+=</span> <span class="mi">1</span>

<span class="nn">File ~/conda/envs/jupybook/lib/python3.10/site-packages/deepxde/model.py:567,</span> in <span class="ni">Model._train_step</span><span class="nt">(self, inputs, targets, auxiliary_vars)</span>
<span class="g g-Whitespace">    </span><span class="mi">565</span>     <span class="bp">self</span><span class="o">.</span><span class="n">train_step</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="n">targets</span><span class="p">,</span> <span class="n">auxiliary_vars</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">566</span> <span class="k">elif</span> <span class="n">backend_name</span> <span class="o">==</span> <span class="s2">&quot;pytorch&quot;</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">567</span>     <span class="bp">self</span><span class="o">.</span><span class="n">train_step</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="n">targets</span><span class="p">,</span> <span class="n">auxiliary_vars</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">568</span> <span class="k">elif</span> <span class="n">backend_name</span> <span class="o">==</span> <span class="s2">&quot;jax&quot;</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">569</span>     <span class="c1"># TODO: auxiliary_vars</span>
<span class="g g-Whitespace">    </span><span class="mi">570</span>     <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">opt_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">train_step</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">571</span>         <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">opt_state</span><span class="p">,</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">targets</span>
<span class="g g-Whitespace">    </span><span class="mi">572</span>     <span class="p">)</span>

<span class="nn">File ~/conda/envs/jupybook/lib/python3.10/site-packages/deepxde/model.py:364,</span> in <span class="ni">Model._compile_pytorch.&lt;locals&gt;.train_step</span><span class="nt">(inputs, targets, auxiliary_vars)</span>
<span class="g g-Whitespace">    </span><span class="mi">361</span>     <span class="n">total_loss</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">362</span>     <span class="k">return</span> <span class="n">total_loss</span>
<span class="ne">--&gt; </span><span class="mi">364</span> <span class="bp">self</span><span class="o">.</span><span class="n">opt</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">closure</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">365</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lr_scheduler</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">366</span>     <span class="bp">self</span><span class="o">.</span><span class="n">lr_scheduler</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>

<span class="nn">File ~/conda/envs/jupybook/lib/python3.10/site-packages/torch/optim/optimizer.py:140,</span> in <span class="ni">Optimizer._hook_for_profile.&lt;locals&gt;.profile_hook_step.&lt;locals&gt;.wrapper</span><span class="nt">(*args, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">138</span> <span class="n">profile_name</span> <span class="o">=</span> <span class="s2">&quot;Optimizer.step#</span><span class="si">{}</span><span class="s2">.step&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">139</span> <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">autograd</span><span class="o">.</span><span class="n">profiler</span><span class="o">.</span><span class="n">record_function</span><span class="p">(</span><span class="n">profile_name</span><span class="p">):</span>
<span class="ne">--&gt; </span><span class="mi">140</span>     <span class="n">out</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">141</span>     <span class="n">obj</span><span class="o">.</span><span class="n">_optimizer_step_code</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">142</span>     <span class="k">return</span> <span class="n">out</span>

<span class="nn">File ~/conda/envs/jupybook/lib/python3.10/site-packages/torch/optim/optimizer.py:23,</span> in <span class="ni">_use_grad_for_differentiable.&lt;locals&gt;._use_grad</span><span class="nt">(self, *args, **kwargs)</span>
<span class="g g-Whitespace">     </span><span class="mi">21</span> <span class="k">try</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">22</span>     <span class="n">torch</span><span class="o">.</span><span class="n">set_grad_enabled</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">defaults</span><span class="p">[</span><span class="s1">&#39;differentiable&#39;</span><span class="p">])</span>
<span class="ne">---&gt; </span><span class="mi">23</span>     <span class="n">ret</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">24</span> <span class="k">finally</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">25</span>     <span class="n">torch</span><span class="o">.</span><span class="n">set_grad_enabled</span><span class="p">(</span><span class="n">prev_grad</span><span class="p">)</span>

<span class="nn">File ~/conda/envs/jupybook/lib/python3.10/site-packages/torch/optim/adam.py:234,</span> in <span class="ni">Adam.step</span><span class="nt">(self, closure, grad_scaler)</span>
<span class="g g-Whitespace">    </span><span class="mi">231</span>                 <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;`requires_grad` is not supported for `step` in differentiable mode&#39;</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">232</span>             <span class="n">state_steps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">state</span><span class="p">[</span><span class="s1">&#39;step&#39;</span><span class="p">])</span>
<span class="ne">--&gt; </span><span class="mi">234</span>     <span class="n">adam</span><span class="p">(</span><span class="n">params_with_grad</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">235</span>          <span class="n">grads</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">236</span>          <span class="n">exp_avgs</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">237</span>          <span class="n">exp_avg_sqs</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">238</span>          <span class="n">max_exp_avg_sqs</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">239</span>          <span class="n">state_steps</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">240</span>          <span class="n">amsgrad</span><span class="o">=</span><span class="n">group</span><span class="p">[</span><span class="s1">&#39;amsgrad&#39;</span><span class="p">],</span>
<span class="g g-Whitespace">    </span><span class="mi">241</span>          <span class="n">beta1</span><span class="o">=</span><span class="n">beta1</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">242</span>          <span class="n">beta2</span><span class="o">=</span><span class="n">beta2</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">243</span>          <span class="n">lr</span><span class="o">=</span><span class="n">group</span><span class="p">[</span><span class="s1">&#39;lr&#39;</span><span class="p">],</span>
<span class="g g-Whitespace">    </span><span class="mi">244</span>          <span class="n">weight_decay</span><span class="o">=</span><span class="n">group</span><span class="p">[</span><span class="s1">&#39;weight_decay&#39;</span><span class="p">],</span>
<span class="g g-Whitespace">    </span><span class="mi">245</span>          <span class="n">eps</span><span class="o">=</span><span class="n">group</span><span class="p">[</span><span class="s1">&#39;eps&#39;</span><span class="p">],</span>
<span class="g g-Whitespace">    </span><span class="mi">246</span>          <span class="n">maximize</span><span class="o">=</span><span class="n">group</span><span class="p">[</span><span class="s1">&#39;maximize&#39;</span><span class="p">],</span>
<span class="g g-Whitespace">    </span><span class="mi">247</span>          <span class="n">foreach</span><span class="o">=</span><span class="n">group</span><span class="p">[</span><span class="s1">&#39;foreach&#39;</span><span class="p">],</span>
<span class="g g-Whitespace">    </span><span class="mi">248</span>          <span class="n">capturable</span><span class="o">=</span><span class="n">group</span><span class="p">[</span><span class="s1">&#39;capturable&#39;</span><span class="p">],</span>
<span class="g g-Whitespace">    </span><span class="mi">249</span>          <span class="n">differentiable</span><span class="o">=</span><span class="n">group</span><span class="p">[</span><span class="s1">&#39;differentiable&#39;</span><span class="p">],</span>
<span class="g g-Whitespace">    </span><span class="mi">250</span>          <span class="n">fused</span><span class="o">=</span><span class="n">group</span><span class="p">[</span><span class="s1">&#39;fused&#39;</span><span class="p">],</span>
<span class="g g-Whitespace">    </span><span class="mi">251</span>          <span class="n">grad_scale</span><span class="o">=</span><span class="n">grad_scale</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">252</span>          <span class="n">found_inf</span><span class="o">=</span><span class="n">found_inf</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">254</span> <span class="k">return</span> <span class="n">loss</span>

<span class="nn">File ~/conda/envs/jupybook/lib/python3.10/site-packages/torch/optim/adam.py:300,</span> in <span class="ni">adam</span><span class="nt">(params, grads, exp_avgs, exp_avg_sqs, max_exp_avg_sqs, state_steps, foreach, capturable, differentiable, fused, grad_scale, found_inf, amsgrad, beta1, beta2, lr, weight_decay, eps, maximize)</span>
<span class="g g-Whitespace">    </span><span class="mi">297</span> <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">298</span>     <span class="n">func</span> <span class="o">=</span> <span class="n">_single_tensor_adam</span>
<span class="ne">--&gt; </span><span class="mi">300</span> <span class="n">func</span><span class="p">(</span><span class="n">params</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">301</span>      <span class="n">grads</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">302</span>      <span class="n">exp_avgs</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">303</span>      <span class="n">exp_avg_sqs</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">304</span>      <span class="n">max_exp_avg_sqs</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">305</span>      <span class="n">state_steps</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">306</span>      <span class="n">amsgrad</span><span class="o">=</span><span class="n">amsgrad</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">307</span>      <span class="n">beta1</span><span class="o">=</span><span class="n">beta1</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">308</span>      <span class="n">beta2</span><span class="o">=</span><span class="n">beta2</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">309</span>      <span class="n">lr</span><span class="o">=</span><span class="n">lr</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">310</span>      <span class="n">weight_decay</span><span class="o">=</span><span class="n">weight_decay</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">311</span>      <span class="n">eps</span><span class="o">=</span><span class="n">eps</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">312</span>      <span class="n">maximize</span><span class="o">=</span><span class="n">maximize</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">313</span>      <span class="n">capturable</span><span class="o">=</span><span class="n">capturable</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">314</span>      <span class="n">differentiable</span><span class="o">=</span><span class="n">differentiable</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">315</span>      <span class="n">grad_scale</span><span class="o">=</span><span class="n">grad_scale</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">316</span>      <span class="n">found_inf</span><span class="o">=</span><span class="n">found_inf</span><span class="p">)</span>

<span class="nn">File ~/conda/envs/jupybook/lib/python3.10/site-packages/torch/optim/adam.py:410,</span> in <span class="ni">_single_tensor_adam</span><span class="nt">(params, grads, exp_avgs, exp_avg_sqs, max_exp_avg_sqs, state_steps, grad_scale, found_inf, amsgrad, beta1, beta2, lr, weight_decay, eps, maximize, capturable, differentiable)</span>
<span class="g g-Whitespace">    </span><span class="mi">408</span>     <span class="n">denom</span> <span class="o">=</span> <span class="p">(</span><span class="n">max_exp_avg_sqs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">sqrt</span><span class="p">()</span> <span class="o">/</span> <span class="n">bias_correction2_sqrt</span><span class="p">)</span><span class="o">.</span><span class="n">add_</span><span class="p">(</span><span class="n">eps</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">409</span> <span class="k">else</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">410</span>     <span class="n">denom</span> <span class="o">=</span> <span class="p">(</span><span class="n">exp_avg_sq</span><span class="o">.</span><span class="n">sqrt</span><span class="p">()</span> <span class="o">/</span> <span class="n">bias_correction2_sqrt</span><span class="p">)</span><span class="o">.</span><span class="n">add_</span><span class="p">(</span><span class="n">eps</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">412</span> <span class="n">param</span><span class="o">.</span><span class="n">addcdiv_</span><span class="p">(</span><span class="n">exp_avg</span><span class="p">,</span> <span class="n">denom</span><span class="p">,</span> <span class="n">value</span><span class="o">=-</span><span class="n">step_size</span><span class="p">)</span>

<span class="ne">KeyboardInterrupt</span>: 
</pre></div>
</div>
</div>
</div>
<p>The model was trained for <span class="math notranslate nohighlight">\(90000\)</span> iterations with a learning rate of <span class="math notranslate nohighlight">\(1\cdot 10^{-3}\)</span>; this learning rate was probably still large, because after about <span class="math notranslate nohighlight">\(20000\)</span> iterations the algorithm looks to turn around some minnimum without being able to reaching it. The methods shows that the best model was reached at epoch 87000, with a train loss of <span class="math notranslate nohighlight">\(4,9\cdot 10^{-4}\)</span>. A training time of <span class="math notranslate nohighlight">\(629\)</span> sec shows that the training of this network was overall fast.</p>
<p>Results can be visualized in the following plots, which once again show that the model was performing nicely before the last iteration was reached, highlighting the power of the optimization of the library and the power of the method.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># reopen saved data using callbacks in fnamevar</span>
<span class="n">lines</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span> <span class="n">fnamevar</span> <span class="p">,</span> <span class="s2">&quot;r&quot;</span> <span class="p">)</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
<span class="c1"># read output data in fnamevar (this line is a long story...)</span>
<span class="n">resumed_params</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span> <span class="p">[</span> <span class="n">np</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span> <span class="nb">min</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="s2">&quot;[&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;(.*?)&quot;</span> <span class="o">+</span> <span class="n">re</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="s2">&quot;]&quot;</span><span class="p">),</span> <span class="n">line</span><span class="p">),</span> <span class="n">key</span><span class="o">=</span><span class="nb">len</span><span class="p">),</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="p">,</span> <span class="p">)</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span> <span class="p">]</span> <span class="p">)</span>

<span class="k">def</span> <span class="nf">plot2</span><span class="p">(</span> <span class="n">resumed_params</span> <span class="p">,</span> <span class="n">lorenz</span> <span class="p">):</span>
    
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span> <span class="mi">13</span> <span class="p">,</span> <span class="mi">5</span> <span class="p">)</span> <span class="p">)</span>
    <span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">121</span><span class="p">)</span>
    <span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">122</span><span class="p">)</span>
    
    <span class="n">l</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">resumed_params</span><span class="o">.</span><span class="n">shape</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span> <span class="nb">range</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="p">,</span> <span class="n">resumed_params</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="p">,</span> <span class="s2">&quot;o&quot;</span> <span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span> <span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;sigma&quot;</span> <span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span> <span class="nb">range</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="p">,</span> <span class="n">resumed_params</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="p">,</span> <span class="s2">&quot;o&quot;</span> <span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;black&quot;</span> <span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;rho&quot;</span> <span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span> <span class="nb">range</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="p">,</span> <span class="n">resumed_params</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="p">,</span> <span class="s2">&quot;o&quot;</span> <span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;blue&quot;</span> <span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;beta&quot;</span> <span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span> <span class="nb">range</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">resumed_params</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">*</span> <span class="n">sigma_true</span> <span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span> <span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;sigma true&quot;</span> <span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span> <span class="nb">range</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">resumed_params</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">*</span> <span class="n">rho_true</span> <span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;black&quot;</span> <span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;rho true&quot;</span> <span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span> <span class="nb">range</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">resumed_params</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">*</span> <span class="n">beta_true</span> <span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;blue&quot;</span> <span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;beta true&quot;</span> <span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span> <span class="n">loc</span> <span class="o">=</span> <span class="s2">&quot;upper right&quot;</span> <span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;# Epoch&quot;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Resumed parameters&quot;</span><span class="p">)</span>
    
    <span class="c1"># Define time domain.</span>
    <span class="n">T</span> <span class="o">=</span> <span class="mf">3.5</span>
    <span class="n">time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span> <span class="mi">0</span> <span class="p">,</span> <span class="n">T</span> <span class="p">,</span> <span class="mi">250</span> <span class="p">)</span>
    <span class="n">lorenz</span> <span class="o">=</span> <span class="n">odeint</span><span class="p">(</span> <span class="n">RHSLorez</span> <span class="p">,</span> <span class="n">x0</span> <span class="p">,</span> <span class="n">time</span> <span class="p">)</span>
    <span class="n">time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">yhat</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">time</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span> <span class="n">time</span> <span class="p">,</span> <span class="n">lorenz</span> <span class="p">,</span> <span class="s2">&quot;o&quot;</span> <span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;xyz&quot;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span> <span class="n">time</span> <span class="p">,</span> <span class="n">yhat</span> <span class="p">,</span> <span class="s2">&quot;--&quot;</span> <span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;xyz pred&quot;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span> <span class="s2">&quot;time&quot;</span> <span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span> <span class="n">loc</span> <span class="o">=</span> <span class="s2">&quot;upper right&quot;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span> <span class="s2">&quot;Data vs predictions&quot;</span> <span class="p">)</span>
    
    <span class="c1">#plt.tight_layout()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">plot2</span><span class="p">(</span> <span class="n">resumed_params</span> <span class="p">,</span> <span class="n">lorenz</span> <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/08cd7e3ab4531839ad9020f1d7a7b998e65b87f09068f7204b372e11c6e15ae7.png" src="../_images/08cd7e3ab4531839ad9020f1d7a7b998e65b87f09068f7204b372e11c6e15ae7.png" />
</div>
</div>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./Exercise 14.X02"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="../Exercise%2014.X01/Exercise_14.X01_.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Exercise 14.X01</p>
      </div>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Nicole Rosi & Jens Peter Schøler
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>